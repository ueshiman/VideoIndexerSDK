@page "/video"
@using BlazorAppWidgets.Components.Services
@inject VideoPlayerService Service
<h3>Azure Video Indexer プレイヤー</h3>

@if (!string.IsNullOrEmpty(VideoEmbedUrl))
{
    <iframe src="@VideoEmbedUrl" width="560" height="315" frameborder="0" allowfullscreen></iframe>
}
else
{
    <p>埋め込みURLを取得中...</p>
}

@code {
    private string VideoEmbedUrl;

    protected override async Task OnInitializedAsync()
    {
        // サーバーサイドでアクセストークン含めたURL生成（仮）
        var accountId = Service.AccountId;
        var videoList = await Service.GetVideoListAsync();
        var videoId = videoList.FirstOrDefault();
        var region = Service.Region;
        var accessToken = Service.AccessToken;
        VideoEmbedUrl = $"https://www.videoindexer.ai/embed/player/{region}/{accountId}/{videoId}?accessToken={accessToken}";
    }

    // private async Task<string> GetVideoIndexerToken()
    // {
    //     // Azure Video Indexer APIを呼び出すロジックをここに書く（例：HttpClientでPOST）
    //     return "abc123"; // 仮のアクセストークン
    // }
}